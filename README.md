# OpenVPN Management System

ä¸€ä¸ªåŸºäºNode.jsçš„OpenVPNç®¡ç†ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„VPNæœåŠ¡ç®¡ç†ã€ç”¨æˆ·è®¤è¯ã€ç½‘ç»œè®¿é—®æ§åˆ¶å’ŒWebç®¡ç†æ¥å£ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” è®¤è¯ä¸æˆæƒ
- å¤šç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- å¯†ç SHA256åŠ å¯†å­˜å‚¨
- Token-basedä¼šè¯ç®¡ç†

### ğŸŒ ç½‘ç»œè®¿é—®æ§åˆ¶
- åŠ¨æ€IPtablesè§„åˆ™ç®¡ç†
- åŸºäºè§’è‰²çš„ç½‘ç»œç»„æƒé™
- CIDRç½‘ç»œæ®µç²¾ç¡®æ§åˆ¶
- å®æ—¶è·¯ç”±ä¸‹å‘

### ğŸ›¡ï¸ VPNæœåŠ¡ç®¡ç†
- OpenVPNæœåŠ¡å¯åŠ¨/åœæ­¢
- å®¢æˆ·ç«¯è¿æ¥ç®¡ç†
- å®æ—¶çŠ¶æ€ç›‘æ§
- åŠ¨æ€é…ç½®ä¸‹å‘

### ğŸ’» Webç®¡ç†æ¥å£
- RESTful APIè®¾è®¡
- ç”¨æˆ·/è§’è‰²/ç½‘ç»œç»„ç®¡ç†
- å®æ—¶é˜²ç«å¢™è§„åˆ™é…ç½®
- å®‰å…¨è·¯å¾„é˜²æŠ¤

## ç³»ç»Ÿæ¶æ„

```
OpenVPN Management System
â”œâ”€â”€ å‰ç«¯ç•Œé¢ (usercenter/)
â”œâ”€â”€ HTTPæœåŠ¡å±‚ (httpserver/)
â”‚   â”œâ”€â”€ UserController - ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ RoleController - è§’è‰²ç®¡ç†
â”‚   â”œâ”€â”€ NetworkController - ç½‘ç»œç»„ç®¡ç†
â”‚   â””â”€â”€ TokenManager - ä¼šè¯ç®¡ç†
â”œâ”€â”€ æ ¸å¿ƒä¸šåŠ¡å±‚ (core/)
â”‚   â”œâ”€â”€ openvpn/ - VPNæœåŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ core.js - ä¸»æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ manager.js - å®¢æˆ·ç«¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.js - é…ç½®ç®¡ç†
â”‚   â””â”€â”€ iptables/ - é˜²ç«å¢™ç®¡ç†
â”‚       â”œâ”€â”€ manager.js - è§„åˆ™ç®¡ç†å™¨
â”‚       â”œâ”€â”€ controller.js - åº•å±‚æ“ä½œ
â”‚       â””â”€â”€ iplearner.js - IPå­¦ä¹ å™¨
â”œâ”€â”€ æ•°æ®è®¿é—®å±‚ (dao/)
â”‚   â”œâ”€â”€ UserDAO - ç”¨æˆ·æ•°æ®
â”‚   â”œâ”€â”€ RoleDAO - è§’è‰²æ•°æ®
â”‚   â””â”€â”€ NetworkDAO - ç½‘ç»œç»„æ•°æ®
â””â”€â”€ é…ç½®å±‚
    â”œâ”€â”€ config.js - åº”ç”¨é…ç½®
    â””â”€â”€ env.js - ç¯å¢ƒé…ç½®
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js**: æ¨è v16+
- **MySQL**: 5.7+
- **OpenVPN**: 2.4+
- **IPtables**: Linuxå†…æ ¸é˜²ç«å¢™

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd OpenVPN-Management
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

3. **æ•°æ®åº“é…ç½®**
   ```sql
   -- åˆ›å»ºæ•°æ®åº“
   CREATE DATABASE openvpn_management;

   -- åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ
   CREATE USER 'ovpn'@'localhost' IDENTIFIED BY 'your_password';
   GRANT ALL PRIVILEGES ON openvpn_management.* TO 'ovpn'@'localhost';
   FLUSH PRIVILEGES;
   ```

4. **é…ç½®æ–‡ä»¶**

   ç¼–è¾‘ `config.js` æ–‡ä»¶ï¼š
   ```javascript
   module.exports = {
       httpServer: {
           port: 8080
       },
       dataBase: {
           host: "localhost",
           port: 3306,
           user: "ovpn",
           password: "your_password",
           database: "openvpn_management"
       }
   }
   ```

5. **å¯åŠ¨æœåŠ¡**
   ```bash
   node test.js
   ```

### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼š
- **ç”¨æˆ·å**: admin
- **å¯†ç **: admin
- **æƒé™**: ç®¡ç†å‘˜ (level 2)

## APIæ¥å£æ–‡æ¡£

### ç”¨æˆ·ç®¡ç†

#### ç”¨æˆ·ç™»å½•
```http
POST /user/login
Content-Type: application/json

{
    "username": "admin",
    "password": "admin"
}
```

#### è·å–ç”¨æˆ·åˆ—è¡¨
```http
GET /user/list
Authorization: Bearer <token>
```

#### åˆ›å»ºç”¨æˆ·
```http
POST /user/create
Authorization: Bearer <token>
Content-Type: application/json

{
    "username": "newuser",
    "password": "password123",
    "roles": ["role_id1", "role_id2"]
}
```

### è§’è‰²ç®¡ç†

#### è·å–è§’è‰²åˆ—è¡¨
```http
GET /role/list
Authorization: Bearer <token>
```

#### åˆ›å»ºè§’è‰²
```http
POST /role/create
Authorization: Bearer <token>
Content-Type: application/json

{
    "name": "å¼€å‘äººå‘˜",
    "networks": ["network_id1", "network_id2"]
}
```

### ç½‘ç»œç»„ç®¡ç†

#### è·å–ç½‘ç»œç»„åˆ—è¡¨
```http
GET /network/list
Authorization: Bearer <token>
```

#### åˆ›å»ºç½‘ç»œç»„
```http
POST /network/create
Authorization: Bearer <token>
Content-Type: application/json

{
    "name": "å†…éƒ¨ç½‘ç»œ",
    "networks": ["192.168.1.0/24", "10.0.0.0/8"]
}
```

## æƒé™çº§åˆ«

ç³»ç»Ÿå®šä¹‰äº†ä¸‰ç§æƒé™çº§åˆ«ï¼š

- **0 - åŒ¿åç”¨æˆ·**: ä»…èƒ½ç™»å½•
- **1 - æ™®é€šç”¨æˆ·**: å¯ä»¥æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯
- **2 - ç®¡ç†å‘˜**: å®Œæ•´çš„ç®¡ç†æƒé™

## ç½‘ç»œè®¿é—®æ§åˆ¶

### ç½‘ç»œç»„é…ç½®

ç½‘ç»œç»„ç”¨äºå®šä¹‰å¯è®¿é—®çš„ç½‘ç»œæ®µï¼š
```json
{
    "name": "åŠå…¬ç½‘ç»œ",
    "networks": ["192.168.1.0/24", "10.10.0.0/16"]
}
```

### è§’è‰²æƒé™å…³è”

è§’è‰²ä¸ç½‘ç»œç»„å…³è”ï¼Œç”¨æˆ·é€šè¿‡è§’è‰²è·å¾—ç½‘ç»œè®¿é—®æƒé™ï¼š
```json
{
    "name": "å¼€å‘è§’è‰²",
    "networks": ["network_group_id1", "network_group_id2"]
}
```

## é˜²ç«å¢™è§„åˆ™

ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†IPtablesè§„åˆ™ï¼š

- ä¸ºæ¯ä¸ªè§’è‰²åˆ›å»ºç‹¬ç«‹çš„IPtablesé“¾
- æ ¹æ®ç”¨æˆ·è¿æ¥åŠ¨æ€åº”ç”¨è§„åˆ™
- æ”¯æŒCIDRç½‘ç»œæ®µç²¾ç¡®æ§åˆ¶
- å®æ—¶è§„åˆ™æ›´æ–°

## å®‰å…¨ç‰¹æ€§

- **è·¯å¾„éå†é˜²æŠ¤**: é˜²æ­¢æ¶æ„æ–‡ä»¶è®¿é—®
- **è¾“å…¥éªŒè¯**: ç”¨æˆ·åã€å¯†ç æ ¼å¼éªŒè¯
- **ä¼šè¯å®‰å…¨**: Tokenè¿‡æœŸæœºåˆ¶
- **æƒé™éªŒè¯**: æ¥å£çº§åˆ«æƒé™æ§åˆ¶

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„è¯´æ˜

- `core/`: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- `httpserver/`: HTTP APIæ¥å£
- `dao/`: æ•°æ®è®¿é—®å¯¹è±¡
- `public/`: é™æ€èµ„æºæ–‡ä»¶
- `ssl/`: SSLè¯ä¹¦ç›®å½•

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨å¯¹åº”æ¨¡å—åˆ›å»ºæ§åˆ¶å™¨
2. å®ç°æ•°æ®è®¿é—®å±‚
3. é…ç½®HTTPè·¯ç”±
4. æ›´æ–°æƒé™éªŒè¯

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **OpenVPNæœåŠ¡æ— æ³•å¯åŠ¨**
   - æ£€æŸ¥OpenVPNé…ç½®æ–‡ä»¶
   - éªŒè¯ç«¯å£æ˜¯å¦è¢«å ç”¨

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
   - éªŒè¯æ•°æ®åº“é…ç½®

3. **é˜²ç«å¢™è§„åˆ™ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥IPtablesæœåŠ¡çŠ¶æ€
   - éªŒè¯ç½‘ç»œç»„é…ç½®

### æ—¥å¿—æŸ¥çœ‹

ç³»ç»Ÿè¿è¡Œæ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ŒåŒ…å«ï¼š
- ç”¨æˆ·è®¤è¯ä¿¡æ¯
- VPNè¿æ¥çŠ¶æ€
- é˜²ç«å¢™è§„åˆ™å˜æ›´
- æ•°æ®åº“æ“ä½œ

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ ISC è®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- é¡¹ç›®Issue
- é‚®ä»¶è”ç³»