<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPN管理系统</title>
    <!-- Bootstrap 3 CSS -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <style>
        /* 仅添加必要的对齐样式和进度条调整 */
        .navbar .container {
            padding-left: 15px;
            padding-right: 15px;
        }
        body {
            padding-top: 50px;
        }
        .progress {
            margin-bottom: 5px;
            height: 10px;
        }
        .progress-info {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <!-- 深色导航栏 -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">切换导航</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
				<a class="navbar-brand" href="/admin/">VPN管理系统</a>
            </div>
            
            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">状态 <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="/admin/">概览</a></li>
                            <li><a href="#">路由</a></li>
                            <li><a href="#">防火墙</a></li>
                            <li><a href="#">系统日志</a></li>
                            <li><a href="#">系统进程</a></li>
                            <li><a href="#">实时信息</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">系统 <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">系统</a></li>
                            <li><a href="#">管理权</a></li>
                            <li><a href="#">软件包</a></li>
                            <li><a href="#">启动项</a></li>
                            <li><a href="#">计划任务</a></li>
                            <li><a href="#">备份与升级</a></li>
                            <li><a href="#">重启</a></li>
                        </ul>
                    </li>
					<li><a href="#">用户管理</a></li>
					<li><a href="#">角色管理</a></li>
					<li><a href="#">网络组管理</a></li>
                    <li><a href="javascript:void(0);" onclick="logout()">退出</a></li>
                </ul>
                
                <div class="navbar-right">
                    <p class="navbar-text">
                        <span class="glyphicon glyphicon-refresh"></span> 刷新
                    </p>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 - 浅色背景 -->
    <div class="container">
        <h2>状态</h2>

        <!-- 系统信息 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">系统</h3>
            </div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">
                    <tr>
                        <td width="33%">主机名</td>
                        <td id="hostname">Loading...</td>
                    </tr>
                    <tr>
                        <td>型号</td>
                        <td id="model">Loading...</td>
                    </tr>
                    <tr>
                        <td>处理器</td>
                        <td id="cpuname">Loading...</td>
                    </tr>
                    <tr>
                        <td>架构</td>
                        <td id="arch">Loading...</td>
                    </tr>
                    <tr>
                        <td>系统版本</td>
                        <td id="target">Loading...</td>
                    </tr>
                    <tr>
                        <td>内核版本</td>
                        <td id="kernel">Loading...</td>
                    </tr>
                    <tr>
                        <td>本地时间</td>
                        <td id="localtime">Loading...</td>
                    </tr>
                    <tr>
                        <td>运行时间</td>
                        <td id="uptime">Loading...</td>
                    </tr>
                    <tr>
                        <td>平均负载</td>
                        <td id="overload">Loading...</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- 内存信息 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">内存</h3>
            </div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">
                    <tr>
                        <td width="33%">可用数</td>
                        <td>
                            <div id="available" class="progress-info">0 MiB / 0 MiB (0%)</div>
                            <div class="progress">
                                <div id="availableProc" class="progress-bar" style="width:0%"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>已使用</td>
                        <td>
                            <div id="used" class="progress-info">0 MiB / 0 MiB (0%)</div>
                            <div class="progress">
                                <div id="usedProc" class="progress-bar" style="width:0%"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>已缓冲</td>
                        <td>
                            <div id="buffers" class="progress-info">0 MiB / 0 MiB (0%)</div>
                            <div class="progress">
                                <div id="buffersProc" class="progress-bar" style="width:0%"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>已缓存</td>
                        <td>
                            <div id="cached" class="progress-info">0 MiB / 0 MiB (0%)</div>
                            <div class="progress">
                                <div id="cachedProc" class="progress-bar" style="width:0%"></div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- 存储空间 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">存储空间使用</h3>
            </div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">

                    <tr>
                        <td width="33%">磁盘空间</td>
                        <td>
                            <div class="progress-info">64.85 MiB / 102.33 MiB (63%)</div>
                            <div class="progress">
                                <div class="progress-bar" style="width:63%"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>临时空间</td>
                        <td>
                            <div class="progress-info">8.03 MiB / 493.45 MiB (1%)</div>
                            <div class="progress">
                                <div class="progress-bar" style="width:1%"></div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- 网络信息 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">网络</h3>
            </div>
            <div class="panel-body">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <strong>IPv4 上游</strong>
                    </div>
                    <div class="panel-body">
                        <p><strong>协议：</strong>静态地址</p>
                        <p><strong>地址：</strong>192.168.252.253/24</p>
                        <p><strong>网关：</strong>192.168.252.254</p>
                        <p><strong>DNS 1：</strong>114.114.114.114</p>
                        <p><strong>DNS 2：</strong>223.5.5.5</p>
                        <p><strong>已连接：</strong>295d 14h 23m 13s</p>
                        
                        <div class="well">
                            <p><strong>设备：</strong>桥接: "br-lan"</p>
                            <p><strong>MAC 地址：</strong>00:0C:29:F2:3A:9B</p>
                        </div>
                    </div>
                </div>
                
                <table class="table table-bordered table-striped">
                    <tr>
                        <td width="33%">活动连接</td>
                        <td>
                            <div class="progress-info">46 / 63488 (0%)</div>
                            <div class="progress">
                                <div class="progress-bar" style="width:0%"></div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        
    </div>

    <!-- 页脚 -->
    <footer class="navbar navbar-default">
        <div class="container">
            <p class="navbar-text">
                <a href="https://github.com/openwrt/luci">Powered by LuCI openwrt-22.03 branch (git-23.119.80898-65ef406)</a> / OpenWrt 22.03.5 r20134-5f15225c1e
            </p>
        </div>
    </footer>

    <!-- 引入本地jQuery和Bootstrap JS -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/public.js"></script>

	<script>
		function init() {
			$.ajax({
				url: "/api/system/systemInfo",
				method: "POST",
				timeout: 10000,
				headers: { "authorization": localStorage.getItem('authToken') }
			,}).done(checkResCode(res => {
				let data = res.data;
				$('#hostname').text(data.hostname);
				$('#model').text(data.model);
				$('#cpuname').text(data.cpuname);
				$('#arch').text(data.arch);
				$('#target').text(data.target);
				$('#kernel').text(data.kernel);
				$('#localtime').text(data.localtime);
				$('#uptime').text(data.uptime);
				$('#overload').text(data.loadavg);
			}));
		}
		
		function getMemInfo() {
			$.ajax({
				url: "/api/system/memInfo",
				method: "POST",
				timeout: 10000,
				headers: { "authorization": localStorage.getItem('authToken') }
			,}).done(checkResCode(res => {
				let data = res.data;
				let available = parseInt(data.available / data.total * 100);
				let used = parseInt(data.used / data.total * 100);
				let buffers = parseInt(data.buffers / data.total * 100);
				let cached = parseInt(data.cached / data.total * 100);

				$('#available').text(`${data.available} MiB / ${data.total} MiB (${available}%)`);
				$('#used').text(`${data.used} MiB / ${data.total} MiB (${used}%)`);
				$('#buffers').text(`${data.buffers} MiB / ${data.total} MiB (${buffers}%)`);
				$('#cached').text(`${data.cached} MiB / ${data.total} MiB (${cached}%)`);

				$('#availableProc').css('width',`${available}%`);
				$('#usedProc').css('width',`${used}%`);
				$('#buffersProc').css('width',`${buffers}%`);
				$('#cachedProc').css('width',`${cached}%`);
			}));
			setTimeout(getMemInfo, 5000);
		}

		init();
		getMemInfo();
	</script>
</body>
</html>